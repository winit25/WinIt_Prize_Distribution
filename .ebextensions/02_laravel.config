option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public
    memory_limit: 512M
  aws:elasticbeanstalk:application:environment:
    COMPOSER_HOME: /root

container_commands:
  01_install_composer_dependencies:
    command: "export COMPOSER_HOME=/root && /usr/bin/composer.phar install --no-dev --optimize-autoloader --no-interaction --prefer-dist"
    cwd: "/var/app/staging"
  02_install_npm_dependencies:
    command: "npm ci --production=false"
    cwd: "/var/app/staging"
  03_build_assets:
    command: "npm run build"
    cwd: "/var/app/staging"
  04_create_storage_link:
    command: "php artisan storage:link || true"
    cwd: "/var/app/staging"
  05_cache_config:
    command: "php artisan config:cache"
    cwd: "/var/app/staging"
  06_cache_routes:
    command: "php artisan route:cache"
    cwd: "/var/app/staging"
  07_cache_views:
    command: "php artisan view:cache"
    cwd: "/var/app/staging"
  08_run_migrations:
    command: "php artisan migrate --force"
    cwd: "/var/app/staging"
    leader_only: true
  09_set_permissions:
    command: "chmod -R 775 storage bootstrap/cache"
    cwd: "/var/app/staging"
