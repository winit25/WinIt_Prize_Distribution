option_settings:
  aws:elasticbeanstalk:application:environment:
    COMPOSER_HOME: /root
    
commands:
  00_disable_default_composer:
    command: "echo 'Skipping default composer install - handled by platform'"
    
container_commands:
  01_create_storage_directories:
    command: |
      # Create directories in both staging and current (for safety)
      mkdir -p /var/app/staging/storage/framework/sessions /var/app/staging/storage/framework/views /var/app/staging/storage/framework/cache /var/app/staging/storage/logs /var/app/staging/bootstrap/cache
      mkdir -p /var/app/staging/storage/app/public /var/app/staging/storage/app/private /var/app/staging/storage/app/temp
      mkdir -p storage/framework/sessions storage/framework/views storage/framework/cache storage/logs bootstrap/cache
      mkdir -p storage/app/public storage/app/private storage/app/temp
      chmod -R 775 /var/app/staging/storage /var/app/staging/bootstrap/cache storage bootstrap/cache
    ignoreErrors: true
  02_permissions:
    command: "chmod -R 775 storage bootstrap/cache || true"
    ignoreErrors: true
  03_storage_link:
    command: "cd /var/app/current && php artisan storage:link || true"
    ignoreErrors: true
  04_config_cache:
    command: "php artisan config:cache || true"
    leader_only: true
