option_settings:
  aws:elasticbeanstalk:application:environment:
    COMPOSER_HOME: /root
    
commands:
  00_create_storage_directories:
    command: |
      mkdir -p /var/app/staging/storage/framework/{sessions,views,cache} /var/app/staging/storage/logs /var/app/staging/bootstrap/cache
      chmod -R 775 /var/app/staging/storage /var/app/staging/bootstrap/cache
      chown -R webapp:webapp /var/app/staging/storage /var/app/staging/bootstrap/cache
    ignoreErrors: true
    
container_commands:
  01_create_directories:
    command: |
      mkdir -p storage/framework/{sessions,views,cache} storage/logs bootstrap/cache
      chmod -R 775 storage bootstrap/cache
      chown -R webapp:webapp storage bootstrap/cache
    ignoreErrors: true
  02_permissions:
    command: |
      chmod -R 775 storage bootstrap/cache
      chown -R webapp:webapp storage bootstrap/cache
    ignoreErrors: true
  03_config_cache:
    command: "php artisan config:cache || true"
    leader_only: true
