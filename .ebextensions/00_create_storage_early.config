# Create storage directories VERY early, before any PHP code runs
# This must run before composer install or artisan commands

commands:
  00_create_staging_storage_early:
    command: |
      mkdir -p /var/app/staging/storage/framework/sessions
      mkdir -p /var/app/staging/storage/framework/views
      mkdir -p /var/app/staging/storage/framework/cache
      mkdir -p /var/app/staging/storage/logs
      mkdir -p /var/app/staging/bootstrap/cache
      chmod -R 775 /var/app/staging/storage
      chmod -R 775 /var/app/staging/bootstrap/cache
      chown -R webapp:webapp /var/app/staging/storage /var/app/staging/bootstrap/cache || true
    ignoreErrors: true

