# Create storage directories VERY early, before composer install
# This runs in the commands section which executes before container_commands

commands:
  00_create_staging_storage_early:
    command: |
      # Create directories with world-writable permissions
      mkdir -p /var/app/staging/storage/framework/sessions
      mkdir -p /var/app/staging/storage/framework/views
      mkdir -p /var/app/staging/storage/framework/cache
      mkdir -p /var/app/staging/storage/logs
      mkdir -p /var/app/staging/bootstrap/cache
      # Make world-writable so any process can write during deployment
      chmod -R 777 /var/app/staging/storage
      chmod -R 777 /var/app/staging/bootstrap/cache
      # Set ownership
      chown -R webapp:webapp /var/app/staging/storage /var/app/staging/bootstrap/cache || true
      # Verify creation
      ls -la /var/app/staging/storage/framework/ || echo "Warning: Could not verify storage directories"
    ignoreErrors: true
