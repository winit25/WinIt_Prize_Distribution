# Create storage directories VERY early, before any PHP code runs
# This must run before composer install or artisan commands
# Use world-writable permissions to allow any process to write during deployment

commands:
  00_create_staging_storage_early:
    command: |
      # Create directories with world-writable permissions
      mkdir -p /var/app/staging/storage/framework/sessions
      mkdir -p /var/app/staging/storage/framework/views
      mkdir -p /var/app/staging/storage/framework/cache
      mkdir -p /var/app/staging/storage/logs
      mkdir -p /var/app/staging/bootstrap/cache
      # Make world-writable so any process can write during deployment
      chmod -R 777 /var/app/staging/storage
      chmod -R 777 /var/app/staging/bootstrap/cache
      # Set ownership
      chown -R webapp:webapp /var/app/staging/storage /var/app/staging/bootstrap/cache || true
    ignoreErrors: true
