# Create storage directories VERY early, before composer install
# This runs in the commands section which executes before container_commands

commands:
  00_create_staging_storage_early:
    command: |
      echo "Creating storage directories BEFORE composer install..."
      mkdir -p /var/app/staging/storage/framework/sessions
      mkdir -p /var/app/staging/storage/framework/views
      mkdir -p /var/app/staging/storage/framework/cache
      mkdir -p /var/app/staging/storage/logs
      mkdir -p /var/app/staging/bootstrap/cache
      chmod -R 777 /var/app/staging/storage
      chmod -R 777 /var/app/staging/bootstrap/cache
      chown -R webapp:webapp /var/app/staging/storage /var/app/staging/bootstrap/cache || true
      echo "Verifying views directory exists..."
      ls -la /var/app/staging/storage/framework/views/ || echo "ERROR: views directory not created!"
    ignoreErrors: false
