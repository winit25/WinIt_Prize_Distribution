version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing Composer"
        - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
        - export PATH="/usr/local/bin:$PATH"
        - composer --version
        - echo "Installing Composer dependencies"
        - composer install --no-dev --optimize-autoloader --no-interaction --prefer-dist
        - echo "Installing Node.js dependencies"
        - npm ci || npm install
        - echo "Generating application key"
        - php artisan key:generate --force
    build:
      commands:
        - echo "Building frontend assets with Vite"
        - npm run build
        - echo "Caching Laravel configuration"
        - php artisan config:cache
        - php artisan route:cache
        - php artisan view:cache
        - echo "Creating storage link"
        - php artisan storage:link || true
  artifacts:
    baseDirectory: /
    files:
      - '**/*'
      - '.env.example'
  cache:
    paths:
      - vendor/**/*
      - node_modules/**/*
      - bootstrap/cache/**/*
